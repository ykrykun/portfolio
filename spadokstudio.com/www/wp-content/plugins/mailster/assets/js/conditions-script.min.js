mailster=function(i,e,t,n){"use strict";i.conditions=i.conditions||{};e.each(e(".mailster-conditions"),function(){var t=e(this),n=t.find(".mailster-conditions-wrap"),a=t.find(".mailster-condition-group"),o=t.find(".mailster-condition");a.eq(0).appendTo(t.find(".mailster-condition-container"));!i.util.trim(n.html())&&n.empty();d();t.on("click",".add-condition",function(){var i=a.length,r=a.eq(0).clone();r.removeAttr("id").appendTo(n).data("id",i).show();e.each(r.find("input, select"),function(){var t=e(this),n=t.attr("name");n&&t.attr("name",n.replace(/\[\d+\]/,"["+i+"]")).prop("disabled",false)});r.find(".condition-field").val("").focus();d();a=t.find(".mailster-condition-group");o=t.find(".mailster-condition")}).on("click",".add-or-condition",function(){var i=e(this).parent(),n=i.find(".mailster-condition").last().data("id"),a=o.eq(0).clone();a.removeAttr("id").appendTo(i).data("id",++n);e.each(a.find("input, select"),function(){var t=e(this),a=t.attr("name");a&&t.attr("name",a.replace(/\[\d+\]\[\d+\]/,"["+i.data("id")+"]["+n+"]")).prop("disabled",false)});a.find(".condition-field").val("").focus();d();o=t.find(".mailster-condition")});n.on("click",".remove-condition",function(){var t=e(this).parent();if(t.parent().find(".mailster-condition").length==1){t=t.parent()}t.slideUp(100,function(){e(this).remove();i.trigger("updateCount")})}).on("change",".condition-field",function(){var t=e(this).closest(".mailster-condition"),n=e(this).val(),a,o;t.find("div.mailster-conditions-value-field").removeClass("active").find(".condition-value").prop("disabled",true);t.find("div.mailster-conditions-operator-field").removeClass("active").find(".condition-operator").prop("disabled",true);o=t.find('div.mailster-conditions-value-field[data-fields*=",'+n+',"]').addClass("active").find(".condition-value").prop("disabled",false);a=t.find('div.mailster-conditions-operator-field[data-fields*=",'+n+',"]').addClass("active").find(".condition-operator").prop("disabled",false);if(!o.length){o=t.find("div.mailster-conditions-value-field-default").addClass("active").find(".condition-value").prop("disabled",false)}if(!a.length){a=t.find("div.mailster-conditions-operator-field-default").addClass("active").find(".condition-operator").prop("disabled",false)}if(!o.val()){if(o.is(".hasDatepicker")){o.datepicker("setDate","yy-mm-dd")}}i.trigger("updateCount")}).on("change",".relative-datepicker",function(){var t=e(this).closest(".mailster-conditions-value-field");var n=t.find("input.relative-datepicker").val()*-1;var a=t.find("select.relative-datepicker").val();t.find("input.datepicker").val(n+" "+a);i.trigger("updateCount")}).on("change",".condition-operator",function(){i.trigger("updateCount")}).on("change",".condition-operator-time",function(){var i=e(this).val(),t=/(is_older|is_younger)/.test(i),n=e(this).closest(".mailster-condition").toggleClass("is-relative",t).find(".mailster-conditions-value-field.active").find(".condition-value"),a=n.val();if(t){var o=r(a);n.next("input.relative-datepicker").val(o[0]).next("select.relative-datepicker").val(o[1]).trigger("change")}else{if(!a.match(/^(\d{4})-(\d{2})-(\d{2})$/))n.val((new Date).toISOString().slice(0,10))}}).on("change",".condition-value",function(){i.trigger("updateCount")}).on("click",".mailster-condition-add-multiselect",function(){e(this).parent().clone().insertAfter(e(this).parent()).find(".condition-value").select().focus();return false}).on("click",".mailster-condition-remove-multiselect",function(){e(this).parent().remove();i.trigger("updateCount");return false}).on("change",".mailster-conditions-value-field-multiselect > .condition-value",function(){if(0==e(this).val()&&e(this).parent().parent().find(".condition-value").size()>1)e(this).parent().remove()}).on("click",".mailster-rating > span",function(i){var t=e(this),n=t.prevAll(),a=t.siblings();a.removeClass("enabled");n.add(t).addClass("enabled");t.parent().parent().find(".condition-value").val((n.length+1)/5).trigger("change")}).find(".condition-field").prop("disabled",false).trigger("change");i.trigger("updateCount");n.find(".is-relative").each(function(){var i=r(e(this).find(".mailster-conditions-value-field.active .condition-value").val());e(this).find("input.relative-datepicker").val(i[0]).next("select.relative-datepicker").val(i[1])});function d(){n.find(".datepicker").datepicker({dateFormat:"yy-mm-dd",firstDay:i.l10n.conditions.start_of_week,showWeek:true,dayNames:i.l10n.conditions.day_names,dayNamesMin:i.l10n.conditions.day_names_min,monthNames:i.l10n.conditions.month_names,prevText:i.l10n.conditions.prev,nextText:i.l10n.conditions.next,showAnim:"fadeIn"})}function s(t){var n=[],a=[],o=e("#list-checkboxes").find("input, select"),d=e("#list-checkboxes").find("input.list"),r=e("#list_extra"),s={},l=e(".mailster-conditions-wrap > .mailster-condition-group"),c=0;e.each(d,function(){var i=e(this).val();if(e(this).is(":checked"))n.push(i)});s.id=i.campaign_id;s.lists=n;s.ignore_lists=e("#ignore_lists").is(":checked");e.each(l,function(){var i=e(this).find(".mailster-condition");e.each(i,function(){var i=e(this),t,n=i.find(".condition-field").val(),o=i.find(".mailster-conditions-operator-field.active").find(".condition-operator").val();if(!o||!n)return;t=i.find(".mailster-conditions-value-field.active").find(".condition-value").map(function(){return e(this).val()}).toArray();if(t.length==1){t=t[0]}if(!a[c]){a[c]=[]}a[c].push({field:n,operator:o,value:t})});c++});s.operator=e("select.mailster-list-operator").val();s.conditions=a;if(t){s=e.extend(t,s)}return s}});function a(t){var n=[],a=[],o=e("#list-checkboxes").find("input, select"),d=e("#list-checkboxes").find("input.list"),r=e("#list_extra"),s={},l=e(".mailster-conditions-wrap > .mailster-condition-group"),c=0;e.each(d,function(){var i=e(this).val();if(e(this).is(":checked"))n.push(i)});s.id=i.campaign_id;s.lists=n;s.ignore_lists=e("#ignore_lists").is(":checked");e.each(l,function(){var i=e(this).find(".mailster-condition");e.each(i,function(){var i=e(this),t,n=i.find(".condition-field").val(),o=i.find(".mailster-conditions-operator-field.active").find(".condition-operator").val();if(!o||!n)return;t=i.find(".mailster-conditions-value-field.active").find(".condition-value").map(function(){return e(this).val()}).toArray();if(t.length==1){t=t[0]}if(!a[c]){a[c]=[]}a[c].push({field:n,operator:o,value:t})});c++});s.operator=e("select.mailster-list-operator").val();s.conditions=a;if(t){s=e.extend(t,s)}return s}function o(i){var e=a();return d(e.conditions,i||"conditions")}function d(i,e){var t=[],n;for(n in i){if(i.hasOwnProperty(n)){var a=e?e+"["+n+"]":n,o=i[n];t.push(o!==null&&typeof o==="object"?d(o,a):encodeURIComponent(a)+"="+encodeURIComponent(o))}}return t.join("&")}function r(i){if(!isNaN(parseFloat(i))&&isFinite(i)){return i}var e;if(e=i.match(/^(\d{4})-(\d{2})-(\d{2})$/)){var t=new Date;t.setHours(0,0,0,0);i=t.getTime()-new Date(e[1],e[2]-1,e[3]).getTime();i=Math.abs(i)/1e3;i=Math.round(i);if(!i){return[1,"days"]}if(!(i/2628e3%1)){i=[i/2628e3,"months"]}else if(!(i/604800%1)){i=[i/604800,"weeks"]}else if(!(i/86400%1)){i=[i/86400,"days"]}else if(!(i/3600%1)){i=[i/3600,"hours"]}else if(!(i/60%1)){i=[Math.ceil(i/60),"minutes"]}}else{i=i.split(" ")}i[0]=Math.abs(i[0]);return i}i.conditions.get=a;i.conditions.serialize=o;return i}(mailster||{},jQuery,window,document);